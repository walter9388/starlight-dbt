---

---

<div class="dbt-switcher">
	<input type="radio" name="dbt-view" id="v-project" value="project" checked />
	<label for="v-project">Project</label>

	<input type="radio" name="dbt-view" id="v-database" value="database" />
	<label for="v-database">Database</label>

	<input type="radio" name="dbt-view" id="v-group" value="group" />
	<label for="v-group">Group</label>
</div>

<script is:inline>
	(() => {
		const saved = localStorage.getItem('starlight-dbt-view-preference');
		if (saved) {
			// Cast the result to HTMLInputElement so we can access .checked
			/** @type {HTMLInputElement | null} */
			const input = document.querySelector(`input[name="dbt-view"][value="${saved}"]`);
			if (input) {
				input.checked = true;
			}
		}
	})();
</script>

<script>
	const syncSidebarExpansion = () => {
		// 1. Find the currently active link that is VISIBLE in the current view
		// We look for aria-current="page"
		const activeLinks = Array.from(
			document.querySelectorAll('.dbt-root-node a[aria-current="page"]')
		) as HTMLElement[];

		activeLinks.forEach((link) => {
			// 2. Walk up the DOM tree from the link
			let parent = link.parentElement;
			while (parent && !parent.classList.contains('dbt-root-node')) {
				// 3. If we hit a <details> element, open it
				if (parent instanceof HTMLDetailsElement) {
					parent.open = true;
				}
				parent = parent.parentElement;
			}
		});

		// 4. Optional: Scroll the sidebar to the active link if it's off-screen
		const visibleActive = Array.from(activeLinks).find((el) => el.offsetParent !== null);
		if (visibleActive) {
			visibleActive.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
		}
	};

	// Trigger expansion when the radio buttons change
	document.addEventListener('change', (e) => {
		const target = e.target as HTMLInputElement;
		if (target && target.name === 'dbt-view') {
			localStorage.setItem('starlight-dbt-view-preference', target.value);

			// Allow a tiny delay for CSS 'display: block' to kick in
			setTimeout(syncSidebarExpansion, 10);
		}
	});

	// Also trigger on initial page load (for the is:inline persistence)
	window.addEventListener('load', syncSidebarExpansion);
</script>

<style>
	.dbt-switcher {
		display: flex;
		background: var(--sl-color-gray-6);
		border-radius: 0.4rem;
		padding: 0.2rem;
		margin: 0.5rem var(--sl-sidebar-item-padding-inline);
		gap: 0.2rem;
		border: 1px solid var(--sl-color-hairline);
	}

	.dbt-switcher input {
		display: none;
	}

	.dbt-switcher label {
		flex: 1;
		text-align: center;
		font-size: 0.7rem;
		padding: 0.25rem;
		cursor: pointer;
		border-radius: 0.25rem;
		color: var(--sl-color-gray-3);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		transition:
			background 0.2s,
			color 0.2s;
	}

	.dbt-switcher input:checked + label {
		background: var(--sl-color-accent-low);
		color: var(--sl-color-white);
		font-weight: 600;
	}
</style>
