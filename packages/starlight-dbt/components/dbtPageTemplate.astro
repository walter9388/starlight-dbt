---
// dbtPageTemplate.astro
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

// TODO: fix typing on dbtData to work natively with virtual-dbt-data.d.ts file, and remove this cast
import { dbtData as dbtDataUntyped } from 'virtual:dbt-data';
import type { dbtData } from '../lib/load/types';
const dbtData = dbtDataUntyped as dbtData;

export async function getStaticPaths() {
	// Generate a page for every node in dbtData
	return Object.values(dbtData.project.nodes).map((node) => {
		return {
			params: { slug: node.unique_id }, // This becomes /docs/dbt/model.my_project.my_model
			props: { node },
		};
	});
}

const { node } = Astro.props;
---

<StarlightPage frontmatter={{ title: node.name }}>
	<p>This page was generated statically for {node.unique_id}</p>
	<pre>{JSON.stringify(node, null, 2)}</pre>
</StarlightPage>
